<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Func.io</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Func.io">
<meta property="og:url" content="http://func.io/author/jose/index.html">
<meta property="og:site_name" content="Func.io">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Func.io">
  
    <link rel="alternate" href="/atom.xml" title="Func.io" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>

<body>
  

  <div class="container">
    <div class="blog-header">
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          
<div class="row">
	<div class="col-sm-4">
		<img style="border-radius: 50%; margin-top: 1em; max-width:100%;
; max-height: 100%" src="http://www.agilogy.com/img/team/jose.jpg" alt ="photo">
	</div>
	<div class="col-sm-8">
		<h1>Jose Raya</h1>
		<p>I am one of the founders at <strong>agilogy</strong> and I like <strong>full stack</strong> and <strong>polyglot</strong> development.  I like to play and experiment with new technology and put it to work for my clients <strong>when</strong> it is ready for them.</p>

	</div>
</div>
<div class="row">
</div>

  
    <article id="post-a-type-safe-string-interpolator-for-jdbc" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/a-type-safe-string-interpolator-for-jdbc.html">A type-safe string interpolator for JDBC</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-author">
      <a href="/author/jose">Jose Raya</a>
    </div>
    <div class="article-datetime">
  <a href="/a-type-safe-string-interpolator-for-jdbc.html" class="article-date"><time datetime="2017-01-19T23:00:00.000Z" itemprop="datePublished">2017-01-20</time></a>
</div>

    

    
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scala/">scala</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/type-classes/">type_classes</a></li></ul>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>There are plenty of frameworks for database access in Scala but for a side project I wanted something that pulled zero dependencies with it and, specially, something that could be used in any project no matter what library we were using in that project.</p>
<p>That meant, as there is nothing for JDBC in the Scala standard library, to hand code my database access against the JDBC APIs. As anyone who has programmed any JDBC can say, it only takes two or three hand-written queries before you start to feel the need to generalize all this boilerplate.</p>
<p>In my case, I was OK with hand-writing the SQL (no FRM or ORM) but, at the same time, I wanted my code to be checked at compile time as much as possible. I wanted a type safe SQL interpolator.</p>
<h1 id="A-very-simple-solution-that-just-works"><a href="#A-very-simple-solution-that-just-works" class="headerlink" title="A very simple solution that just works"></a>A very simple solution that just works</h1><p>For our first iteration we will check the official <a href="http://docs.scala-lang.org/overviews/core/string-interpolation.html" target="_blank" rel="external">documentation</a> and write an interpolator based in the examples there:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ListBuffer</span></div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlStatement</span>(<span class="params">source:<span class="type">String</span>, vars: <span class="type">Seq</span>[<span class="type">Any</span>]</span>)</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">JdbcInterpolation</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">implicit</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlInterpolation</span>(<span class="params">val sc: <span class="type">StringContext</span></span>) <span class="keyword">extends</span> <span class="title">AnyVal</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sql</span></span>(args:<span class="type">Any</span>*): <span class="type">SqlStatement</span> = &#123;</div><div class="line">      <span class="keyword">val</span> strings = sc.parts.iterator</div><div class="line">      <span class="keyword">val</span> builder = <span class="keyword">new</span> <span class="type">StringBuilder</span></div><div class="line">      <span class="keyword">while</span> (strings.hasNext) &#123;</div><div class="line">        builder.append(strings.next())</div><div class="line">        <span class="keyword">if</span> (strings.hasNext) &#123;</div><div class="line">        	<span class="comment">//If there are more strings, a param goes here</span></div><div class="line">          builder.append(<span class="string">"?"</span>)</div><div class="line">        &#125; </div><div class="line">      &#125;</div><div class="line">      <span class="type">SqlStatement</span>(builder.mkString.trim(), args)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This is very simple to use:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">"Jdbc interpolation"</span>) &#123;</div><div class="line"></div><div class="line">  <span class="keyword">import</span> <span class="type">JdbcInterpolation</span>._</div><div class="line">	</div><div class="line">  it(<span class="string">"should work if there are no substitutions"</span>) &#123;</div><div class="line">    <span class="keyword">val</span> ps = <span class="string">sql"select 2+2 from dual"</span></div><div class="line">    assert(ps.source == <span class="string">"select 2+2 from dual"</span>)</div><div class="line">  &#125;</div><div class="line">	</div><div class="line">  it(<span class="string">"should replace a var with a ? and keep its value"</span>) &#123;</div><div class="line">    <span class="keyword">val</span> id = <span class="number">1</span></div><div class="line">    <span class="keyword">val</span> ps = <span class="string">sql"select name from users where id=<span class="subst">$id</span>"</span></div><div class="line">	</div><div class="line">    assert(ps.source == <span class="string">"select name from users where id=?"</span>)</div><div class="line">    assert(ps.vars == <span class="type">Seq</span>(id))</div><div class="line">  &#125;</div><div class="line">	</div><div class="line">  it(<span class="string">"should keep the order of the variables"</span>) &#123;</div><div class="line">    <span class="keyword">val</span> id = <span class="number">1</span></div><div class="line">    <span class="keyword">val</span> city = <span class="string">"BCN"</span></div><div class="line">    <span class="keyword">val</span> ps = <span class="string">sql"select name from users where id=<span class="subst">$id</span> and city=<span class="subst">$city</span>"</span></div><div class="line">	</div><div class="line">    assert(ps.source == <span class="string">"select name from users where id=? and city=?"</span>)</div><div class="line">    assert(ps.vars == <span class="type">Seq</span>(id, city))</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>As you can see, you don’t need a fancy framework to get SQL interpolation. You can actually make this work with a plain old JDBC Prepared statement and call it a day:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ss is of type SqlStatement</span></div><div class="line"><span class="keyword">val</span> ps = conn.prepareStatement(ss.source)</div><div class="line">ss.vars.zipWithIndex.foreach &#123; <span class="keyword">case</span> (v,i) =&gt;</div><div class="line">  ps.setObject(i,v)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Of course, being Scala developers, we know we can do better and we expect something more from our compiler. Specifically, this solution can fail at run-time if the driver does not know what to do with our object because the interpolator accepts <code>Any</code> as parameter and we know that <code>setObject</code> only works for a given set of types.</p>
<p>What we need is a way to limit which types can be used in our interpolator so that, if we try to use a non-supported type in the interpolator we get a compile error. There are several solutions to this problem but we are going to use type classes because it is the most flexible one for this scenario.</p>
<h1 id="A-type-safe-solution-with-type-classes"><a href="#A-type-safe-solution-with-type-classes" class="headerlink" title="A type-safe solution with type classes"></a>A type-safe solution with type classes</h1><p>First of all, let’s refresh our knowledge about type classes: </p>
<p>A type class allows us to define classes (or groups, sets, or whatever you want to call them) of types that satisfy a given propiety. In our example, this property is “it can be used as a parameter in a statement”. If we know how to set a parameter of type T then T belongs to our class, otherwise it doesn’t.</p>
<p>In Scala, to define a type class, we define a trait with a type parameter (the type parameter is the type that belongs to the class) and, for every type that we want to belong to the class, we define an implicit object that acts as an evidence: If we can resolve an implicit that implements the trait for a type T then T belongs to our class, if we cannot resolve the implicit then it does not belong to the class.</p>
<p>In our case, we need to define a trait <code>JdbcParameterCompatible[T]</code> and, for every type <code>[T]</code> that can be used as a parameter, an evidence object.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.sql.<span class="type">PreparedStatement</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">trait</span> <span class="title">JdbcParameterCompatible</span>[<span class="type">T</span>] </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">set</span></span>(ps:<span class="type">PreparedStatement</span>, index:<span class="type">Int</span>, value:<span class="type">T</span>): <span class="type">Unit</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">DefaultMappers</span> </span>&#123;</div><div class="line">  <span class="keyword">implicit</span> <span class="keyword">val</span> stringEvidence = <span class="keyword">new</span> <span class="type">JdbcParameterCompatible</span>[<span class="type">String</span>] &#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">set</span></span>(ps: <span class="type">PreparedStatement</span>, index: <span class="type">Int</span>, value: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</div><div class="line">      ps.setString(index, value)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">implicit</span> <span class="keyword">val</span> intEvidence = <span class="keyword">new</span> <span class="type">JdbcParameterCompatible</span>[<span class="type">Int</span>] &#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">set</span></span>(ps: <span class="type">PreparedStatement</span>, index: <span class="type">Int</span>, value: <span class="type">Int</span>): <span class="type">Unit</span> = &#123;</div><div class="line">      ps.setInt(index, value)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The trait <code>JdbcParameterCompatible</code> defines a method (<code>set</code>) that sets a parameter in a statement. Now all we need is a way to make our interpolator require an evidence that a variable is “mappable” when we try to interpolate it.</p>
<p>Right now, our <code>sql</code> method cannot ask for the evidence because we are using <code>Any*</code> as the type of our parameter but there is nothing preventing us from defining a set of <code>sql</code> methods with different arity, each one of them asking for as many evidence parameters as arguments we have:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SetableParameter</span>[<span class="type">T</span>](<span class="params">value:<span class="type">T</span>, mapper: <span class="type">JdbcParameterCompatible</span>[<span class="type">T</span>]</span>)</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">JdbcInterpolation</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">implicit</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlInterpolation</span>(<span class="params">val sc: <span class="type">StringContext</span></span>) <span class="keyword">extends</span> <span class="title">AnyVal</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sql</span></span>(): <span class="type">SqlStatement</span> = &#123;</div><div class="line">      statement()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sql</span></span>[<span class="type">T</span>](arg: <span class="type">T</span>)(<span class="keyword">implicit</span> mapper: <span class="type">JdbcParameterCompatible</span>[<span class="type">T</span>]): <span class="type">SqlStatement</span> = &#123;</div><div class="line">      statement(param(arg))</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sql</span></span>[<span class="type">T</span>, <span class="type">U</span>](arg1: <span class="type">T</span>, arg2:<span class="type">U</span>)(<span class="keyword">implicit</span> mapper1: <span class="type">JdbcParameterCompatible</span>[<span class="type">T</span>], mapper2: <span class="type">JdbcParameterCompatible</span>[<span class="type">U</span>]): <span class="type">SqlStatement</span> = &#123;</div><div class="line">      statement(param(arg1), param(arg2))</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">statement</span></span>(args: <span class="type">SetableParameter</span>[_]*): <span class="type">SqlStatement</span> = &#123;</div><div class="line">      <span class="type">SqlStatement</span>(statementWithPlaceHolders, args)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">param</span></span>[<span class="type">T</span>](arg: <span class="type">T</span>)(<span class="keyword">implicit</span> mapper: <span class="type">JdbcParameterCompatible</span>[<span class="type">T</span>]): <span class="type">SetableParameter</span>[<span class="type">T</span>] = &#123;</div><div class="line">      <span class="type">SetableParameter</span>(arg, mapper)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">statementWithPlaceHolders</span></span>: <span class="type">String</span> = &#123;</div><div class="line">      <span class="keyword">val</span> strings = sc.parts.iterator</div><div class="line">      <span class="keyword">val</span> builder = <span class="keyword">new</span> <span class="type">StringBuilder</span></div><div class="line">      <span class="keyword">while</span> (strings.hasNext) &#123;</div><div class="line">        <span class="keyword">val</span> str = strings.next()</div><div class="line">        builder.append(str)</div><div class="line">        <span class="keyword">if</span> (strings.hasNext) &#123;</div><div class="line">          builder.append(<span class="string">"?"</span>)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      builder.mkString.trim</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now, if we want our previous tests to compile, we need to bring into scope the DefaultMappers. If we don’t, we will get an error like this one:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Error:(27, 16) could not find implicit value for parameter mapper2: com.agilogy.jdbc.interpolation. JdbcParameterCompatible[String]</div><div class="line">      val ps = sql&quot;select name from users where id=$id and city=$city&quot;</div></pre></td></tr></table></figure>
<p>And this is exactly what we wanted :)</p>
<p>#Summary</p>
<p>Of course, this solution is far from perfect as it requires a non-negligible amount of boilerplate (we need as many versions of the sql method as the maximum number of parameters we want to support) but we have a very powerful interpolator that is:</p>
<ul>
<li>Easy to use: No more writing ‘?’ in the query and making sure that the args are in the right order</li>
<li>Easy to extend: If we want to support new types all we need to do is bring a <code>JdbcParameterCompatible[T]</code> in scope</li>
<li>Has no dependencies other than scala and jdbc.</li>
<li>Type-safe: If we use the wrong type as parameter we will know it at compile-time</li>
</ul>
<p>As an exercise, we can try to apply a similar type-class based approach to the result of the query (you can see a hint <a href="https://gist.github.com/joseraya/0894cc79d1249bb0606306500e64699c" target="_blank" rel="external">here</a></p>
<p>You can find the code for this article here: <a href="https://github.com/joseraya/jdbc-interpolator" target="_blank" rel="external">https://github.com/joseraya/jdbc-interpolator</a></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://func.io/a-type-safe-string-interpolator-for-jdbc.html" data-id="ciy75jm0b000062pbkogz43tk" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
    </footer>
  </div>
  
</article>



  
    <article id="post-monads-for-the-pragmatic" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/monads-for-the-pragmatic.html">Monads for the pragmatic</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-author">
      <a href="/author/jose">Jose Raya</a>
    </div>
    <div class="article-datetime">
  <a href="/monads-for-the-pragmatic.html" class="article-date"><time datetime="2016-11-23T22:35:47.000Z" itemprop="datePublished">2016-11-23</time></a>
</div>

    

    
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scala/">scala</a></li></ul>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>There are plenty of monad articles but most of them are written from the assumption that monads are a good thing but sometimes fail to explain why they are a good thing. What I want to do in this article is to give an overview of the design trade-offs behing monads.</p>
<h2 id="An-example-Promises"><a href="#An-example-Promises" class="headerlink" title="An example: Promises"></a>An example: Promises</h2><p>If you have written some Javascript in the last years, you will probably have used promises. Promises are cool because they avoid the <a href="https://en.wikipedia.org/wiki/Pyramid_of_doom_(programming" target="_blank" rel="external">callback pyramid of doom</a>) problem and are more composable than callbacks.</p>
<p>A typical use case for promises are http requests: (from <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" target="_blank" rel="external">here</a>)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myImage = <span class="built_in">document</span>.querySelector(<span class="string">'img'</span>);</div><div class="line"></div><div class="line">fetch(<span class="string">'flowers.jpg'</span>)</div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> response.blob();</div><div class="line">&#125;)</div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">myBlob</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> objectURL = URL.createObjectURL(myBlob);</div><div class="line">  myImage.src = objectURL;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Promises are cool because we can chain <code>.then</code> invocations and write code that looks sequential even though the execution is asynchronous.</p>
<h2 id="What-do-promises-have-to-do-with-monads"><a href="#What-do-promises-have-to-do-with-monads" class="headerlink" title="What do promises have to do with monads?"></a>What do promises have to do with monads?</h2><p>Believe it or not, promises are a lot like monads (although I am not sure that we can properly call them monads and I don’t want to give a definition of what is and what is not a monad).</p>
<p>A <a href="https://www.haskell.org/tutorial/monads.html" target="_blank" rel="external">monad</a> has two operations: <code>bind</code> and <code>return</code>. In our example, the <code>then</code> operation would be the <code>bind</code> operation (<code>flatMap</code> in Scala) that allows us to chain calculations.</p>
<p>If we were to write the former code in Scala we would write something like this:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> myImage = document.querySelector(<span class="symbol">'im</span>g');</div><div class="line"></div><div class="line">myImage.src = fetch(<span class="string">"flowers.jpg"</span>)</div><div class="line">.flatMap(response =&gt; &#123;</div><div class="line">  response.blob()</div><div class="line">&#125;)</div><div class="line">.map(myBlob =&gt; &#123;</div><div class="line">  <span class="type">URL</span>.createObjectURL(myBlob)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>or, with a for comprehension:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> myImage = document.querySelector(<span class="symbol">'im</span>g');</div><div class="line">myImage.src = <span class="keyword">for</span> &#123;</div><div class="line">	response &lt;- fetch(<span class="string">"flowers.jpg"</span>)</div><div class="line">	myBlob &lt;- response.blob()</div><div class="line">&#125; <span class="keyword">yield</span> &#123;</div><div class="line">	<span class="type">URL</span>.createObjectURL(myBlob)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Did you see what I did? The scala version of the code uses a different name for the <code>bind</code> operation. Instead of <code>then</code> (that only makes sense for promises) I used a more generic name <code>flatMap</code>, and this is one of the main reasons to use monads:</p>
<blockquote>
<p>By following a convention (or implementing a common interface) monads allow generic manipulation without really understanding<br>what the monad does</p>
</blockquote>
<p>The for comprehension works for Promises, but it also works for <code>Try</code>, or <code>Option</code> or any other monad we may want to implement. </p>
<p>Another example:</p>
<p>Let’s say that we implement a function that takes a <code>Seq[Promise[T]]</code> and returns a <code>Promise[Seq[T]]</code>. If later on we want a function<br>that takes a <code>Seq[Option[T]]</code> and returns an <code>Option[Seq[T]]</code> we can reuse the same funcion only if both are monads because they have some properties in common. If we were to write an Option equivalent in javascript, we could not reuse our methods that work with promises because the <code>then</code> method is specific for promises (of course we can create an <code>Option::then</code> method but that would be a bit weird).</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://func.io/monads-for-the-pragmatic.html" data-id="ciy75jm0g000262pbt9mmspr2" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ad-hoc-polymorphism-in-scala" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/ad-hoc-polymorphism-in-scala.html">Ad-hoc polymorphism in scala</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-author">
      <a href="/author/jose">Jose Raya</a>
    </div>
    <div class="article-datetime">
  <a href="/ad-hoc-polymorphism-in-scala.html" class="article-date"><time datetime="2016-11-09T23:00:00.000Z" itemprop="datePublished">2016-11-10</time></a>
</div>

    

    
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scala/">scala</a></li></ul>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://en.wikipedia.org/wiki/Ad_hoc_polymorphism">Ad-hoc polymorphism</a>, also known as <em>operator overloading</em> allows a function to behave differently for different parameters. In this posts we will see some of the limitations of operator overloading and how to overcome them in an idiomatic way.</p>
<p>TL;DR:</p>
<ul>
<li>Scala supports ad-hoc polymorphism as a language feature</li>
<li>But it has issues with generics because of type erasure</li>
<li>Some generics are not obvious (for instance, functions)</li>
<li>Pattern matching is a really bad solution to this problem</li>
<li>We can solve these issues with type classes</li>
</ul>
        
          <p class="article-more-link">
            <a class="btn btn-primary" href="/ad-hoc-polymorphism-in-scala.html#more">Read More</a>
          </p>
        
      
    </div>

    

    <footer class="article-footer">
      <a data-url="http://func.io/ad-hoc-polymorphism-in-scala.html" data-id="ciy75jm0k000562pbuorlcfxa" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
    </footer>
  </div>
  
</article>



  
    <article id="post-reboot" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/reboot.html">Reboot</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-author">
      <a href="/author/jose">Jose Raya</a>
    </div>
    <div class="article-datetime">
  <a href="/reboot.html" class="article-date"><time datetime="2016-11-08T23:00:00.000Z" itemprop="datePublished">2016-11-09</time></a>
</div>

    

    
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/about/">about</a></li></ul>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://func.io">funció</a>! This is a blog where we talk about functional programming and, specially, <a href="http://scala-lang.org" target="_blank" rel="external">scala</a>.<br>This is a new version of the blog that is <a href="http://github.com/funcio/funcio.github.io" target="_blank" rel="external">open source</a> and made with <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>. The old blog is still availabe on <a href="http://funcio.tumblr.com" target="_blank" rel="external">tumblr</a>.</p>
<p>It is difficult to blog regularly and this is not our intention. But, on the other hand, we have some interesting conversations in our internal #scala channel on slack and we wanted a place where we could explore in detail the ideas we talk about there and, at the same time, to share these stories with the world.</p>
<p>As a result, most of the articles will be about things we find in our day-to-day use of scala which we think is a good thing :)</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://func.io/reboot.html" data-id="ciy75jm0n000662pbtf4qpbp8" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
    </footer>
  </div>
  
</article>



  




        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <a href="/">
    <img src='/img/logofuncionotes.png'/>
    <h2>Funció</h2> 
  </a>
  <h4>/ˈfun’sió/</h4>
  
  
    <h5>FP from the Agilogy team</h5>
  
</div>


  


  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/about/">about</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/scala/">scala</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/type-classes/">type_classes</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/about/" style="font-size: 10px;">about</a> <a href="/tags/scala/" style="font-size: 20px;">scala</a> <a href="/tags/type-classes/" style="font-size: 10px;">type_classes</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/01/">January 2017</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/11/">November 2016</a><span class="sidebar-module-list-count">2</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/a-type-safe-string-interpolator-for-jdbc.html">A type-safe string interpolator for JDBC</a>
        </li>
      
        <li>
          <a href="/monads-for-the-pragmatic.html">Monads for the pragmatic</a>
        </li>
      
        <li>
          <a href="/reboot.html">Reboot</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
     <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
